services:
  openclaw-gateway:
    image: ${OPENCLAW_IMAGE:-ghcr.io/openclaw/openclaw:main}
    container_name: openclaw-gateway

    user: "${DOCKER_USER_ID:-1000}:${DOCKER_GROUP_ID:-1000}"
    group_add:
      - "${DOCKER_GID:-989}"

    environment:
      HOME: ${OPENCLAW_DATA_DIR:-/data/openclaw}
      OPENCLAW_STATE_DIR: ${OPENCLAW_DATA_DIR:-/data/openclaw}
      TERM: xterm-256color
      NODE_ENV: production
      NODE_OPTIONS: "--max-old-space-size=4096"

      # 环境变量会被 OpenClaw 自动替换到配置文件中
      # LLM Provider 配置（通用）
      LLM_PROVIDER: ${LLM_PROVIDER}
      LLM_BASE_URL: ${LLM_BASE_URL}
      LLM_API_KEY: ${LLM_API_KEY}
      LLM_MODEL_ID: ${LLM_MODEL_ID}
      LLM_API_TYPE: ${LLM_API_TYPE}

      # 企业微信配置
      WECOM_TOKEN: ${WECOM_TOKEN}
      WECOM_ENCODING_AES_KEY: ${WECOM_ENCODING_AES_KEY}

      # Gateway 配置
      GATEWAY_PORT: ${GATEWAY_PORT:-18789}
      GATEWAY_MODE: ${GATEWAY_MODE:-local}
      GATEWAY_BIND: ${GATEWAY_BIND:-lan}
      GATEWAY_AUTH_TOKEN: ${GATEWAY_AUTH_TOKEN}

      # 其他配置
      USER_TIMEZONE: ${USER_TIMEZONE:-Asia/Shanghai}
      TIME_FORMAT: ${TIME_FORMAT:-24}

    volumes:
      - ${OPENCLAW_DATA_DIR:-/data/openclaw}:${OPENCLAW_DATA_DIR:-/data/openclaw}:rw
      - /var/run/docker.sock:/var/run/docker.sock
      - /usr/bin/docker:/usr/bin/docker

    ports:
      - "${GATEWAY_PORT:-18789}:${GATEWAY_PORT:-18789}"

    networks:
      - openclaw-net

    init: true
    restart: unless-stopped

    command:
      - "node"
      - "dist/index.js"
      - "gateway"
      - "--bind"
      - "${GATEWAY_BIND:-lan}"
      - "--port"
      - "${GATEWAY_PORT:-18789}"

networks:
  openclaw-net:
    driver: bridge
